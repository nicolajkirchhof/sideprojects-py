<app-content-area [showRightSidebar]="showSidebar">
  <div main>
    <div class="actions flex justify-end mx-4 mb-2">
      <button mat-raised-button color="primary" (click)="onNew()">
        New Position
      </button>
    </div>
    <div class="mat-elevation-z8 m-4">
      <table mat-table [dataSource]="positions" class="w-full">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.id }} </td>
        </ng-container>

        <!-- InstrumentId Column -->
        <ng-container matColumnDef="instrumentId">
          <th mat-header-cell *matHeaderCellDef> Instrument ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.instrumentId }} </td>
        </ng-container>

        <!-- ContractId Column -->
        <ng-container matColumnDef="contractId">
          <th mat-header-cell *matHeaderCellDef> Contract ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.contractId }} </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef> Type </th>
          <td mat-cell *matCellDef="let element"> {{ element.type }} </td>
        </ng-container>

        <!-- Opened Column -->
        <ng-container matColumnDef="opened">
          <th mat-header-cell *matHeaderCellDef> Opened </th>
          <td mat-cell *matCellDef="let element"> {{ element.opened | date:'short' }} </td>
        </ng-container>

        <!-- Expiry Column -->
        <ng-container matColumnDef="expiry">
          <th mat-header-cell *matHeaderCellDef> Expiry </th>
          <td mat-cell *matCellDef="let element"> {{ element.expiry | date:'short' }} </td>
        </ng-container>

        <!-- Closed Column -->
        <ng-container matColumnDef="closed">
          <th mat-header-cell *matHeaderCellDef> Closed </th>
          <td mat-cell *matCellDef="let element"> {{ element.closed ? (element.closed | date:'short') : '—' }} </td>
        </ng-container>

        <!-- Size Column -->
        <ng-container matColumnDef="size">
          <th mat-header-cell *matHeaderCellDef> Size </th>
          <td mat-cell *matCellDef="let element"> {{ element.size }} </td>
        </ng-container>

        <!-- Strike Column -->
        <ng-container matColumnDef="strike">
          <th mat-header-cell *matHeaderCellDef> Strike </th>
          <td mat-cell *matCellDef="let element"> {{ element.strike }} </td>
        </ng-container>

        <!-- Cost Column -->
        <ng-container matColumnDef="cost">
          <th mat-header-cell *matHeaderCellDef> Cost </th>
          <td mat-cell *matCellDef="let element"> {{ element.cost }} </td>
        </ng-container>

        <!-- Close Column -->
        <ng-container matColumnDef="close">
          <th mat-header-cell *matHeaderCellDef> Close </th>
          <td mat-cell *matCellDef="let element"> {{ element.close ?? '—' }} </td>
        </ng-container>

        <!-- Comission Column -->
        <ng-container matColumnDef="comission">
          <th mat-header-cell *matHeaderCellDef> Commission </th>
          <td mat-cell *matCellDef="let element"> {{ element.comission ?? '—' }} </td>
        </ng-container>

        <!-- Multiplier Column -->
        <ng-container matColumnDef="multiplier">
          <th mat-header-cell *matHeaderCellDef> Multiplier </th>
          <td mat-cell *matCellDef="let element"> {{ element.multiplier }} </td>
        </ng-container>

        <!-- CloseReason Column -->
        <ng-container matColumnDef="closeReason">
          <th mat-header-cell *matHeaderCellDef> Close Reason </th>
          <td mat-cell *matCellDef="let element"> {{ element.closeReason || '—' }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowSelect(row)" class="cursor-pointer"></tr>
      </table>
    </div>
  </div>
  <div sidebar>
    @if (showSidebar) {
      <form [formGroup]="form" (ngSubmit)="onSave()" class="flex flex-col gap-3">
        @if (!isCreating) {
          <mat-form-field appearance="outline">
            <mat-label>ID</mat-label>
            <input matInput formControlName="id" readonly>
          </mat-form-field>
        }

        <mat-form-field appearance="outline">
          <mat-label>Instrument</mat-label>
          <mat-select formControlName="instrumentId">
            <mat-option [value]="null">Select instrument</mat-option>
            <mat-option *ngFor="let inst of instruments" [value]="inst.id">
              {{ inst.symbol }} (ID: {{ inst.id }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Instrument Specifics</mat-label>
          <input matInput formControlName="instrumentSpecifics">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contract ID</mat-label>
          <input matInput formControlName="contractId">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <mat-select formControlName="type">
            <mat-option [value]="'Call'">Call</mat-option>
            <mat-option [value]="'Put'">Put</mat-option>
            <mat-option [value]="'Underlying'">Underlying</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Opened</mat-label>
          <input matInput [matDatepicker]="dpOpened" formControlName="opened">
          <mat-datepicker-toggle matSuffix [for]="dpOpened"></mat-datepicker-toggle>
          <mat-datepicker #dpOpened></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Expiry</mat-label>
          <input matInput [matDatepicker]="dpExpiry" formControlName="expiry">
          <mat-datepicker-toggle matSuffix [for]="dpExpiry"></mat-datepicker-toggle>
          <mat-datepicker #dpExpiry></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Closed</mat-label>
          <input matInput [matDatepicker]="dpClosed" formControlName="closed">
          <mat-datepicker-toggle matSuffix [for]="dpClosed"></mat-datepicker-toggle>
          <mat-datepicker #dpClosed></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Size</mat-label>
          <input matInput type="number" formControlName="size">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Strike</mat-label>
          <input matInput type="number" formControlName="strike">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Cost</mat-label>
          <input matInput type="number" formControlName="cost">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Close</mat-label>
          <input matInput type="number" formControlName="close">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Commission</mat-label>
          <input matInput type="number" formControlName="comission">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Multiplier</mat-label>
          <input matInput type="number" formControlName="multiplier">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Close Reason</mat-label>
          <input matInput formControlName="closeReason">
        </mat-form-field>

        <div class="flex gap-2 justify-end mt-2">
          <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-flat-button color="primary" type="submit">Save</button>
        </div>
      </form>
    }
  </div>
</app-content-area>
