<app-content-area [showRightSidebar]="showSidebar">
  <div main>
    <div class="actions flex justify-end mx-4 mb-2">
      <button mat-raised-button color="primary" (click)="onNew()">
        New Log Entry
      </button>
    </div>
    <div class="mat-elevation-z8 m-4">
      <table mat-table [dataSource]="logs" class="w-full">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.id }} </td>
        </ng-container>

        <!-- InstrumentId Column -->
        <ng-container matColumnDef="instrumentId">
          <th mat-header-cell *matHeaderCellDef> Instrument ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.instrumentId }} </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef> Date </th>
          <td mat-cell *matCellDef="let element"> {{ element.date | date:'short' }} </td>
        </ng-container>

        <!-- Notes Column -->
        <ng-container matColumnDef="notes">
          <th mat-header-cell *matHeaderCellDef> Notes </th>
          <td mat-cell *matCellDef="let element"> {{ element.notes || '—' }} </td>
        </ng-container>

        <!-- Strategy Column -->
        <ng-container matColumnDef="strategy">
          <th mat-header-cell *matHeaderCellDef> Strategy </th>
          <td mat-cell *matCellDef="let element"> {{ element.strategy || '—' }} </td>
        </ng-container>

        <!-- Sentiment Column -->
        <ng-container matColumnDef="sentiment">
          <th mat-header-cell *matHeaderCellDef> Sentiment </th>
          <td mat-cell *matCellDef="let element"> {{ sentimentToLabels(element.sentiment) }} </td>
        </ng-container>





        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowSelect(row)" class="cursor-pointer"></tr>
      </table>
    </div>
  </div>
  <div sidebar class="flex flex-1 ">
    @if (showSidebar) {
      <form [formGroup]="form" (ngSubmit)="onSave()" class="flex flex-col w-full pr-4 gap-3 h-full min-h-0">
        @if (!isCreating) {
          <mat-form-field appearance="outline">
            <mat-label>ID</mat-label>
            <input matInput formControlName="id" readonly>
          </mat-form-field>
        }

        <mat-form-field appearance="outline">
          <mat-label>Instrument</mat-label>
          <mat-select formControlName="instrumentId">
            <mat-option [value]="null">Select instrument</mat-option>
            <mat-option *ngFor="let inst of instruments" [value]="inst.id">
              {{ inst.symbol }} (ID: {{ inst.id }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="dpDate" formControlName="date">
          <mat-datepicker-toggle matSuffix [for]="dpDate"></mat-datepicker-toggle>
          <mat-datepicker #dpDate></mat-datepicker>
        </mat-form-field>


        <mat-form-field appearance="outline">
          <mat-label>Strategy</mat-label>
          <input matInput formControlName="strategy">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Sentiment</mat-label>
          <mat-select formControlName="sentiment" multiple>
            <mat-option [value]="1">Bullish</mat-option>
            <mat-option [value]="2">Neutral</mat-option>
            <mat-option [value]="4">Bearish</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Notes as last field -->
        <div class="flex flex-col gap-1 flex-1 min-h-0">
          <div class="flex items-center justify-between">
            <label class="text-sm font-medium">Notes</label>
            <button mat-icon-button type="button" class="w-8 h-8 p-0" (click)="toggleQuillToolbar()" aria-label="Toggle editor toolbar">
              <mat-icon>{{ showToolbar ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
          </div>
          <div class="relative flex flex-col flex-1 min-h-0">
            @if (showToolbar) {
              <quill-editor class="!flex flex-col flex-1 h-full min-h-0 overflow-hidden" [modules]="quillModules" formControlName="notes" theme="snow"></quill-editor>
            } @else {
              <quill-editor class="!flex flex-col flex-1 h-full min-h-0 overflow-hidden" [modules]="quillModulesOff" formControlName="notes" theme="snow"></quill-editor>
            }
          </div>
        </div>

        <div class="flex gap-2 justify-end mt-2">
          <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-flat-button color="primary" type="submit">Save</button>
        </div>
      </form>
    }
  </div>
</app-content-area>
