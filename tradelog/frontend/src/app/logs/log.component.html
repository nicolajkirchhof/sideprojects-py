<app-content-area [showRightSidebar]="showSidebar">
  <div main>
    <div class="actions flex justify-end mx-4 mb-2">
      <button mat-raised-button color="primary" (click)="onNew()">
        New Log Entry
      </button>
    </div>
    <div class="mat-elevation-z8 m-4">
      <table mat-table [dataSource]="logs" class="w-full">

        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.id }} </td>
        </ng-container>

        <!-- InstrumentId Column -->
        <ng-container matColumnDef="instrumentId">
          <th mat-header-cell *matHeaderCellDef> Instrument ID </th>
          <td mat-cell *matCellDef="let element"> {{ element.instrumentId }} </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef> Date </th>
          <td mat-cell *matCellDef="let element"> {{ element.date | date:'short' }} </td>
        </ng-container>

        <!-- Notes Column -->
        <ng-container matColumnDef="notes">
          <th mat-header-cell *matHeaderCellDef> Notes </th>
          <td mat-cell *matCellDef="let element"> {{ element.notes || '—' }} </td>
        </ng-container>

        <!-- Strategy Column -->
        <ng-container matColumnDef="strategy">
          <th mat-header-cell *matHeaderCellDef> Strategy </th>
          <td mat-cell *matCellDef="let element"> {{ element.strategy || '—' }} </td>
        </ng-container>

        <!-- Sentiment Column -->
        <ng-container matColumnDef="sentiment">
          <th mat-header-cell *matHeaderCellDef> Sentiment </th>
          <td mat-cell *matCellDef="let element"> {{ sentimentToLabels(element.sentiment) }} </td>
        </ng-container>

        <!-- TA Column -->
        <ng-container matColumnDef="ta">
          <th mat-header-cell *matHeaderCellDef> TA </th>
          <td mat-cell *matCellDef="let element"> {{ element.ta || '—' }} </td>
        </ng-container>

        <!-- ExpectedOutcome Column -->
        <ng-container matColumnDef="expectedOutcome">
          <th mat-header-cell *matHeaderCellDef> Expected Outcome </th>
          <td mat-cell *matCellDef="let element"> {{ element.expectedOutcome || '—' }} </td>
        </ng-container>

        <!-- Lernings Column -->
        <ng-container matColumnDef="lernings">
          <th mat-header-cell *matHeaderCellDef> Lernings </th>
          <td mat-cell *matCellDef="let element"> {{ element.lernings || '—' }} </td>
        </ng-container>

        <!-- FA Column -->
        <ng-container matColumnDef="fa">
          <th mat-header-cell *matHeaderCellDef> FA </th>
          <td mat-cell *matCellDef="let element"> {{ element.fa || '—' }} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowSelect(row)" class="cursor-pointer"></tr>
      </table>
    </div>
  </div>
  <div sidebar>
    @if (showSidebar) {
      <form [formGroup]="form" (ngSubmit)="onSave()" class="flex flex-col gap-3">
        @if (!isCreating) {
          <mat-form-field appearance="outline">
            <mat-label>ID</mat-label>
            <input matInput formControlName="id" readonly>
          </mat-form-field>
        }

        <mat-form-field appearance="outline">
          <mat-label>Instrument</mat-label>
          <mat-select formControlName="instrumentId">
            <mat-option [value]="null">Select instrument</mat-option>
            <mat-option *ngFor="let inst of instruments" [value]="inst.id">
              {{ inst.symbol }} (ID: {{ inst.id }})
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="dpDate" formControlName="date">
          <mat-datepicker-toggle matSuffix [for]="dpDate"></mat-datepicker-toggle>
          <mat-datepicker #dpDate></mat-datepicker>
        </mat-form-field>

        <div class="flex justify-end">
          <button mat-stroked-button type="button" (click)="toggleQuillToolbar()">
            {{ showToolbar ? 'Hide editor toolbar' : 'Show editor toolbar' }}
          </button>
        </div>

        <div class="flex flex-col gap-1 mb-3">
          <label class="text-sm font-medium">Notes</label>
          <quill-editor class="quill-resizable" [modules]="quillModules" formControlName="notes" theme="snow" [style.height.px]="120"></quill-editor>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Strategy</mat-label>
          <input matInput formControlName="strategy">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Sentiment</mat-label>
          <mat-select formControlName="sentiment" multiple>
            <mat-option [value]="1">Bullish</mat-option>
            <mat-option [value]="2">Neutral</mat-option>
            <mat-option [value]="4">Bearish</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="flex flex-col gap-1 mb-3">
          <label class="text-sm font-medium">TA</label>
          <quill-editor class="quill-resizable" [modules]="quillModules" formControlName="ta" theme="snow" [style.height.px]="120"></quill-editor>
        </div>

        <div class="flex flex-col gap-1 mb-3">
          <label class="text-sm font-medium">Expected Outcome</label>
          <quill-editor class="quill-resizable" [modules]="quillModules" formControlName="expectedOutcome" theme="snow" [style.height.px]="120"></quill-editor>
        </div>

        <div class="flex flex-col gap-1 mb-3">
          <label class="text-sm font-medium">Lernings</label>
          <quill-editor class="quill-resizable" [modules]="quillModules" formControlName="lernings" theme="snow" [style.height.px]="120"></quill-editor>
        </div>

        <div class="flex flex-col gap-1 mb-3">
          <label class="text-sm font-medium">FA</label>
          <quill-editor class="quill-resizable" [modules]="quillModules" formControlName="fa" theme="snow" [style.height.px]="120"></quill-editor>
        </div>

        <div class="flex gap-2 justify-end mt-2">
          <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
          <button mat-flat-button color="primary" type="submit">Save</button>
        </div>
      </form>
    }
  </div>
</app-content-area>
